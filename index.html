<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ESX Assistant Conversational Log Preview</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-date-fns@3.0.0/dist/chartjs-adapter-date-fns.bundle.min.js"></script>
    <link rel="stylesheet" href="css/styles.css">
</head>
<body>
    <div class="header">
        <h1>ESX Assistant Conversational Log Preview</h1>
        <div class="header-right">
            <span class="file-path" id="filePath">No file loaded</span>
            <div class="file-input-wrapper">
                <input type="file" id="fileInput" accept=".jsonl,.log,.txt" />
                <label for="fileInput" class="icon-btn">üìÅ</label>
            </div>
            <button class="icon-btn" id="refreshBtn" disabled>üîÑ</button>
        </div>
    </div>

    <div id="emptyState" class="empty-state" style="display: flex; align-items: center; justify-content: center; height: calc(100vh - 37px);">
        <div>
            <h2>No Audit Log Loaded</h2>
            <p>Load an audit log file (.jsonl) to visualize session data</p>
            <div class="file-input-wrapper">
                <input type="file" id="fileInput2" accept=".jsonl,.log,.txt" />
                <label for="fileInput2" class="icon-btn" style="padding: 0.5rem 1rem; font-size: 12px;">üìÅ Choose File</label>
            </div>
        </div>
    </div>

    <div id="mainLayout" class="main-layout" style="display: none;">
        <div class="left-sidebar" id="leftSidebar">
            <button class="sidebar-toggle" id="leftToggle" title="Toggle sidebar">‚óÄ</button>
            <select id="sessionSelector" disabled>
                <option>No sessions loaded</option>
            </select>

            <div class="kpi-section">
                <h3>Session Statistics</h3>
                <div class="kpi-list">
                    <div class="kpi-item">Input Tokens: <strong id="inputTokens">0</strong></div>
                    <div class="kpi-item">Output Tokens: <strong id="outputTokens">0</strong></div>
                    <div class="kpi-item clickable" id="priceKPI">Estimated Cost: <strong id="estimatedCost">$0.00</strong></div>
                    <div class="kpi-item">Total Events: <strong id="totalEvents">0</strong></div>
                    <div class="kpi-item">Duration: <strong id="sessionDuration">0s</strong></div>
                    <div class="kpi-item">Tool Success: <strong id="toolSuccess">0%</strong></div>
                </div>
            </div>

            <div class="kpi-section">
                <h3>Quick Insights</h3>
                <div class="insights-list" id="insightsList"></div>
            </div>

            <div class="filter-section">
                <h3>Filters</h3>
                <div class="filter-group">
                    <h4>Event Types</h4>
                    <div class="checkbox-group">
                        <label class="checkbox-label">
                            <input type="checkbox" id="filter_api_call_request" checked>
                            <span>API Requests</span>
                        </label>
                        <label class="checkbox-label">
                            <input type="checkbox" id="filter_api_call_response" checked>
                            <span>API Responses</span>
                        </label>
                    </div>
                </div>
                <div class="filter-group">
                    <h4>Search</h4>
                    <input type="text" class="search-input" id="searchInput" placeholder="Search content...">
                </div>
                <div class="filter-group">
                    <h4>Quick Actions</h4>
                    <div class="quick-filters">
                        <button class="quick-filter-btn" id="showErrorsBtn">‚ö†Ô∏è Errors Only</button>
                        <button class="quick-filter-btn" id="showAllBtn">‚úì Show All</button>
                        <button class="quick-filter-btn" id="collapseAllBtn">‚ñ∂ Collapse All</button>
                        <button class="quick-filter-btn" id="expandAllBtn">‚ñº Expand All</button>
                    </div>
                </div>
            </div>
        </div>

        <div class="center-content">
            <div id="errorMessage" class="error-message" style="display: none;"></div>

            <div class="view-tabs">
                <button class="view-tab active" id="timelineTab" data-view="timeline">Event Timeline</button>
                <button class="view-tab" id="conversationTab" data-view="conversation">Conversation</button>
            </div>

            <div id="timelineView">
                <div class="events-header">
                    <h2>Event Timeline</h2>
                    <span class="events-count" id="eventsCount">0 events</span>
                </div>
                <div class="events-list" id="eventsList"></div>
            </div>

            <div id="conversationView" style="display: none;">
                <div class="events-header">
                    <h2>Conversation</h2>
                    <span class="events-count" id="conversationCount">0 lines</span>
                </div>
                <div class="conversation-list" id="conversationList"></div>
            </div>
        </div>

        <div class="right-sidebar" id="rightSidebar">
            <button class="sidebar-toggle" id="rightToggle" title="Toggle sidebar">‚ñ∂</button>
            <div class="chart-section">
                <h3>Input Tokens Per Event</h3>
                <div class="chart-container">
                    <canvas id="inputPerEventChart"></canvas>
                </div>
            </div>
            <div class="chart-section">
                <h3>Cumulative Input Tokens</h3>
                <div class="chart-container">
                    <canvas id="inputCumulativeChart"></canvas>
                </div>
            </div>
            <div class="chart-section">
                <h3>Output Tokens Per Event</h3>
                <div class="chart-container">
                    <canvas id="outputPerEventChart"></canvas>
                </div>
            </div>
            <div class="chart-section">
                <h3>Cumulative Output Tokens</h3>
                <div class="chart-container">
                    <canvas id="outputCumulativeChart"></canvas>
                </div>
            </div>
        </div>
    </div>

    <div class="modal-overlay" id="priceModal">
        <div class="modal">
            <div class="modal-header">
                <h2>Configure Model Pricing</h2>
                <button class="modal-close" id="closePriceModal">√ó</button>
            </div>
            <div class="modal-body" id="priceModalBody"></div>
            <div class="modal-footer">
                <button class="btn btn-secondary" id="resetPriceBtn">Reset to Defaults</button>
                <button class="btn btn-primary" id="savePriceBtn">Save Configuration</button>
            </div>
        </div>
    </div>

    <script src="js/app.js"></script>
</body>
</html>
